# 新增課程後會發生什麼事

## 一、後端（API + 資料庫）

當你送出「新增課程」表單後，後端會依序做這些事：

### 1. 寫入一筆課程

- 在 **`classes`** 表新增一筆資料。
- 內容包含：課程名稱、主課老師、開始/結束日期、上課星期、總堂數、學費、繳費期數、繳費頻率等。
- **`enrolled_students`** 一開始是空陣列（尚未有學生報名）。

### 2. 自動產生「會話」（Sessions）

- 依課程的 **開始日期、結束日期、上課星期、總堂數**，自動算出每一堂課的日期。
- 在 **`sessions`** 表為該課程建立多筆會話，每筆代表「某一堂課」：
  - 會記錄：所屬課程 ID、日期、實際授課老師（預設同主課老師）、是否順延（預設否）。
  - **點名名單（attendance）** 新建時為空（因為還沒有學生報名）。
- 之後在 **日曆總覽**、**課程日曆**、**歷史課表** 裡看到的排課，就是這些會話。

### 3. 不會在新增課程時產生「交易」

- **交易（transactions）** 不會在新增課程時建立。
- 交易是在 **學生報名該課程** 時，才依課程的學費與繳費期數，為該學生產生對應的繳費記錄。

---

## 二、前端（畫面與資料）

### 1. 送出表單後

- 呼叫 **`classApi.create(...)`** 把課程資料送到後端。
- 後端成功後會回傳新建的課程（含 ID）。

### 2. 重新拉取全部資料

- 前端會執行 **`fetchData()`**，再次向後端取得：
  - 學生、課程、會話、交易 的最新列表。
- 所以畫面上會立刻看到：
  - **課堂系統**：多一筆新課程。
  - **日曆總覽**：新課程的會話會出現在對應日期。
  - **歷史課表**：若會話日期已在過去，也會出現在歷史列表。

### 3. 表單與提示

- 新增課程表單會被清空並關閉。
- 會顯示成功訊息：**「課程已成功添加並生成會話！」**。

---

## 三、之後你可以做什麼

| 操作 | 說明 |
|------|------|
| **為課程報名學生** | 在「學生管理」或「課堂系統」裡，選擇學生報名到這門課；系統會為該學生產生對應的 **交易（繳費記錄）**。 |
| **查看／編輯課程日曆** | 在課堂系統點該課程的「課程日曆」，可看到自動產生的會話、順延、手動開關會話等。 |
| **點名** | 在「日曆總覽」點某一天，或從課程日曆進入，可對該堂會話做點名（已到/未到/請假/順延）。 |
| **財務管理** | 學生報名後，在「財務管理」會出現該課程的繳費記錄，可標記已繳費、列印收據或繳費通知。 |

---

## 四、簡短總結

**新增課程後會發生：**

1. 資料庫多一筆 **課程**。
2. 系統依排課規則自動產生多筆 **會話**（每堂課一筆）。
3. 前端重新拉資料，畫面更新，並顯示「課程已成功添加並生成會話！」。
4. **交易** 要等「學生報名該課程」後才會產生。
