# 無法連線至後端 — 排查說明

前端出現「無法連線至後端」時，請依下列情境檢查。

---

## 一、本地開發（前端跑在 localhost:3000）

前端預設會連到 **http://localhost:8000**。若後端沒在 8000 port 啟動，就會連線失敗。

### 1. 確認後端有啟動

**必須先單獨啟動後端**，再開前端：

1. 開啟 **PowerShell** 或命令提示字元。
2. 進入專案根目錄：
   ```powershell
   cd c:\Users\fyu\Desktop\1111\cram_school
   ```
3. 設定 Python 能找到 `backend` 套件（二選一）：
   - **PowerShell**：
     ```powershell
     $env:PYTHONPATH = "c:\Users\fyu\Desktop\1111\cram_school"
     ```
   - **命令提示字元 (cmd)**：
     ```cmd
     set PYTHONPATH=c:\Users\fyu\Desktop\1111\cram_school
     ```
4. 啟動後端：
   ```powershell
   python -m uvicorn backend.api.index:app --reload --host 0.0.0.0 --port 8000
   ```
5. 看到類似 `Uvicorn running on http://0.0.0.0:8000` 表示成功。
6. 在瀏覽器打開 **http://localhost:8000/docs**，若有 Swagger 頁面代表後端正常。
7. 再執行前端的 `npm start`（在 `frontend` 資料夾），前端即可連到後端。

### 2. 用專案內腳本啟動（建議）

在專案根目錄執行：

```powershell
.\scripts\start-backend.ps1
```

或（若已設好 PYTHONPATH）：

```powershell
python -m uvicorn backend.api.index:app --reload --host 0.0.0.0 --port 8000
```

### 3. 常見問題

| 狀況 | 處理方式 |
|------|----------|
| 從 `backend` 資料夾執行 uvicorn | 一定要從**專案根目錄**（cram_school）執行，否則 `backend.api.index` 會找不到。 |
| `ModuleNotFoundError: No module named 'backend'` | 設定 **PYTHONPATH** 為專案根目錄（見上方步驟 3）。 |
| Port 8000 已被佔用 | 換 port，例如 `--port 8001`，並在 frontend 設定對應的 API 網址（見下方）。 |
| 防火牆／防毒阻擋 | 允許 Python 或 uvicorn 存取網路／localhost。 |

### 4. 若後端改用其他 port

例如改用 8001，前端需知道後端網址：

- 在 **frontend** 目錄新增或編輯 `.env.development`（或 `.env.local`）：
  ```env
  REACT_APP_BACKEND_API_URL=http://localhost:8001
  ```
- 重啟前端（`npm start`）。  
  **注意**：若未設此變數，開發環境預設是 `http://localhost:8000`（見 `frontend/src/api/apiService.js`）。

---

## 二、生產環境（已部署到 Vercel 等）

- 前端在生產環境會用 **`/api`** 當後端基底（同一網域下的相對路徑）。
- 需在 Vercel 上正確設定 **API 路由**，把 `/api/*` 轉發到 FastAPI 後端。
- 若部署後仍無法連線，請檢查：
  1. Vercel 的 **vercel.json** 是否有把 `/api` 指到後端。
  2. 環境變數 **REACT_APP_BACKEND_API_URL** 是否為 `/api`（或你實際的後端網址）。

---

## 三、快速檢查後端是否可連

在後端**已啟動**的情況下：

- 瀏覽器打開：**http://localhost:8000/health**  
  應看到類似：`{"status":"ok", ...}`
- 或打開：**http://localhost:8000/docs**  
  應看到 Swagger API 文件。

若這兩者都打不開，代表後端未在 8000 port 運行或本機被阻擋，請回到「一、本地開發」依步驟啟動並設定 PYTHONPATH。
