# 學生管理系統測試結果

## 一、後端 API 測試

### 問題與修正
- **問題**：POST `/students/` 新增學生時回傳 **500 Internal Server Error**，後端日誌為 **RecursionError: maximum recursion depth exceeded**。
- **原因**：`backend/api/index.py` 中，路由函數名稱與從 `backend.crud` 匯入的函數同名（例如 `create_student`），在路由內呼叫 `create_student(...)` 時變成呼叫自己，造成無限遞迴。
- **修正**：已將 crud 匯入改為別名（如 `crud_create_student`），並在路由內改為呼叫 `crud_create_student`。課程、會話、交易端點也一併修正。

### 測試結果（修正後需重啟後端）

| 項目 | 方法 | 路徑 | 結果 |
|------|------|------|------|
| 健康檢查 | GET | `/health` | ✅ 通過 |
| 取得學生列表 | GET | `/students/` | ✅ 通過 |
| 新增學生 | POST | `/students/` | ⚠️ 需重啟後端後再測 |
| 取得單一學生 | GET | `/students/{id}` | ⚠️ 需重啟後端後再測 |
| 更新學生 | PUT | `/students/{id}` | ⚠️ 需重啟後端後再測 |
| 刪除學生 | DELETE | `/students/{id}` | ⚠️ 需重啟後端後再測 |

### 請重啟後端後再驗證
在專案根目錄執行（先關閉目前執行中的後端，再執行）：
```powershell
cd c:\Users\fyu\Desktop\1111\cram_school
$env:PYTHONPATH = "c:\Users\fyu\Desktop\1111\cram_school"
python -m uvicorn backend.api.index:app --reload --host 0.0.0.0 --port 8000
```
然後可到 **http://localhost:8000/docs** 手動測試 POST /students/、PUT、DELETE，或使用前端的「學生管理」頁操作。

---

## 二、前端與後端對接

### 前端學生相關邏輯
- **API 基底**：`frontend/src/api/apiService.js` 的 `studentApi` 對應後端：
  - `getAll()` → GET `/students/`
  - `create(data)` → POST `/students/`
  - `update(id, data)` → PUT `/students/{id}`
  - `delete(id)` → DELETE `/students/{id}`
- **資料流**：`frontend/src/hooks/useTuitionData.js` 在載入時呼叫 `studentApi.getAll()` 取得列表；新增、編輯、刪除分別呼叫 `studentApi.create`、`studentApi.update`、`studentApi.delete`。
- **頁面**：`StudentManagementPage`、`StudentForm`、`StudentPaymentModal` 等組成學生管理介面，依賴上述 API。

### 結論
- 後端：**GET /students/** 與 **/health** 已驗證正常；其餘學生 CRUD 在修正遞迴問題後，需**重啟後端**才會生效。
- 前端：學生管理頁與 API 路徑、方法對應正確，只要後端重啟後 API 正常，前端新增/編輯/刪除學生應可正常運作。

---

## 三、建議手動測試步驟（重啟後端後）

1. 開啟 http://localhost:3000，進入「學生管理」。
2. 確認列表可正常顯示（對應 GET /students/）。
3. 點「新增學生」，填寫姓名、年齡、年級、學校、電話、出生日期後送出，確認列表出現新學生且無錯誤訊息。
4. 點某位學生的「編輯」，修改後儲存，確認列表更新。
5. 點「刪除」並確認，該學生從列表消失。

若上述皆正常，即表示學生管理前後端運作正常。
